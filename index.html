<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Governança - Sedimentados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Map Libs -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Chart Lib -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Timeline Lib -->
    <script src="https://cdn.jsdelivr.net/npm/vis-timeline@7.7.3/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/vis-timeline@7.7.3/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />

    <style>
        :root {
            --color-primary: #6fb36e;
            --color-background: #eef7ea;
            --color-surface: #f8f3e9;
            --color-text-primary: #12190f;
            --color-text-secondary: #0e0b09;
        }
        body {
            background-color: var(--color-background);
            color: var(--color-text-primary);
            font-family: 'Inter', sans-serif;
        }
        .bg-primary { background-color: var(--color-primary); }
        .bg-surface { background-color: var(--color-surface); }
        .text-primary { color: var(--color-text-primary); }
        .text-secondary { color: var(--color-text-secondary); }
        .border-primary { border-color: var(--color-primary); }
        
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link.active {
            background-color: var(--color-primary);
            color: white;
            font-weight: 600;
        }
        .nav-link:not(.active):hover {
            background-color: #eef7ea;
        }

        /* Kanban Styles */
        .kanban-column {
            min-height: 400px;
        }
        .kanban-card {
            cursor: pointer; /* Changed to pointer to indicate clickability */
            transition: all 0.2s ease-in-out;
        }
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .kanban-card.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .drop-zone {
            transition: background-color 0.3s ease;
        }
        .drop-zone.drag-over {
            background-color: #d1fae5; /* Tailwind green-100 */
        }
        .actor-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }
        .actor-avatar:not(:first-child) {
            margin-left: -12px;
        }

        /* Vis-Timeline Customization */
        .vis-timeline {
            border: 2px solid var(--color-primary);
            border-radius: 8px;
            background-color: var(--color-surface);
        }
        .vis-item {
            background-color: var(--color-primary);
            border-color: #5a9d5a;
            color: white;
            border-radius: 5px;
        }
        .vis-item.vis-selected {
            background-color: #5a9d5a;
            border-color: var(--color-text-primary);
        }
        .vis-time-axis .vis-grid.vis-odd {
            background: #f8f3e9;
        }
        /* Custom marker for today on timeline */
        .vis-custom-time.today-marker {
            border-left: 2px dashed #ef4444; /* red-500 */
        }
        .vis-custom-time.today-marker .vis-label {
            background-color: #ef4444;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            transform: translateY(-100%);
            top: -5px;
        }


        /* Modal Styles */
        #task-modal, #actor-modal {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }
        #task-modal.visible, #actor-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #task-modal .modal-content, #actor-modal .modal-content {
            transform: scale(0.95);
            transition: transform 0.3s ease-in-out;
        }
        #task-modal.visible .modal-content, #actor-modal.visible .modal-content {
            transform: scale(1);
        }
        
        /* Profile Dropdown transition */
        #profile-dropdown {
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="bg-surface shadow-md sticky top-0 z-50">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <!-- Logo and Title -->
                    <div class="flex items-center">
                        <img src="Logo.svg" alt="Logo Sedimentados" class="h-12 w-auto">
                    </div>
                    
                    <!-- Desktop Nav -->
                    <nav class="hidden md:flex space-x-2 bg-background p-1 rounded-full">
                        <a href="#dashboard" class="nav-link px-4 py-2 rounded-full text-sm">Dashboard de Impacto</a>
                        <a href="#kanban" class="nav-link px-4 py-2 rounded-full text-sm">Kanban do Projeto</a>
                        <a href="#actors" class="nav-link px-4 py-2 rounded-full text-sm">Atores Envolvidos</a>
                        <a href="#deliverables" class="nav-link px-4 py-2 rounded-full text-sm">Entregáveis</a>
                    </nav>

                    <!-- Right side: Profile and Mobile Menu Button -->
                    <div class="flex items-center space-x-2">
                         <!-- Profile Dropdown -->
                        <div class="relative">
                            <button id="profile-button" class="block transition-transform duration-200 hover:scale-110 focus:outline-none">
                                <img id="current-user-avatar" src="" alt="Avatar do usuário" class="h-10 w-10 rounded-full border-2 border-primary object-cover">
                            </button>
                            <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-xl z-20 py-1 origin-top-right transform opacity-0 scale-95">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Meu Perfil</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Configurações</a>
                                <div class="border-t border-gray-100"></div>
                                <a href="#" class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50">Sair</a>
                            </div>
                        </div>

                         <!-- Mobile Menu Button -->
                        <div class="md:hidden">
                            <button id="mobile-menu-button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary">
                                <span class="sr-only">Abrir menu principal</span>
                                <svg id="menu-icon-open" class="h-6 w-6 block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                                </svg>
                                <svg id="menu-icon-close" class="h-6 w-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden md:hidden bg-surface shadow-lg">
                <nav class="flex flex-col space-y-1 px-2 pt-2 pb-3">
                    <a href="#dashboard" class="nav-link text-gray-700 hover:bg-background block px-3 py-2 rounded-md text-base font-medium">Dashboard de Impacto</a>
                    <a href="#kanban" class="nav-link text-gray-700 hover:bg-background block px-3 py-2 rounded-md text-base font-medium">Kanban do Projeto</a>
                    <a href="#actors" class="nav-link text-gray-700 hover:bg-background block px-3 py-2 rounded-md text-base font-medium">Atores Envolvidos</a>
                    <a href="#deliverables" class="nav-link text-gray-700 hover:bg-background block px-3 py-2 rounded-md text-base font-medium">Entregáveis</a>
                </nav>
            </div>
        </header>


        <!-- Main Content -->
        <main id="main-content" class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            <!-- Pages will be rendered here -->
        </main>
    </div>

    <!-- Task Detail Modal -->
    <div id="task-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 z-[100] hidden items-center justify-center p-4">
        <div class="modal-content bg-surface rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div id="task-modal-inner-content" class="p-6 sm:p-8 overflow-y-auto">
                <!-- Content will be injected by JS -->
            </div>
        </div>
    </div>
    
    <!-- Actor Detail Modal -->
    <div id="actor-modal" class="fixed inset-0 bg-gray-900 bg-opacity-60 z-[100] hidden items-center justify-center p-4">
        <div class="modal-content bg-surface rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div id="actor-modal-inner-content" class="p-6 sm:p-8 overflow-y-auto">
                <!-- Content will be injected by JS -->
            </div>
        </div>
    </div>


    <!-- JSON Database -->
    <script id="db-json" type="application/json">
{
  "config": {
    "theme": {
      "colors": {
        "primary": "#6fb36e",
        "background": "#eef7ea",
        "surface": "#f8f3e9",
        "textPrimary": "#12190f",
        "textSecondary": "#0e0b09"
      }
    },
    "currentUser": {
      "id": "user-ferroport-01",
      "name": "Gestor de Sustentabilidade",
      "avatarUrl": "https://i.pravatar.cc/150?u=user-ferroport-01"
    }
  },
  "actors": [
    {
      "id": "actor-01",
      "name": "Comitê Gestor Ferroport",
      "type": "Grupo Interno",
      "location": {
        "name": "Porto do Açu",
        "lat": -21.8219,
        "lng": -41.0186
      }
    },
    {
      "id": "actor-02",
      "name": "Universidade Estadual do Norte Fluminense (UENF)",
      "type": "Academia",
      "location": {
        "name": "Campos dos Goytacazes",
        "lat": -21.7554,
        "lng": -41.3259
      }
    },
    {
      "id": "actor-03",
      "name": "Prefeitura de São João da Barra",
      "type": "Poder Público",
      "location": {
        "name": "São João da Barra",
        "lat": -21.6401,
        "lng": -41.051
      }
    },
    {
      "id": "actor-04",
      "name": "INEA",
      "type": "Órgão Regulador",
      "location": {
        "name": "Rio de Janeiro",
        "lat": -22.9068,
        "lng": -43.1729
      }
    },
    {
      "id": "actor-05",
      "name": "Comunidade de Pipeiras",
      "type": "Comunidade",
      "location": {
        "name": "Pipeiras, SJB",
        "lat": -21.668,
        "lng": -41.060
      }
    },
    {
      "id": "actor-06",
      "name": "Cooperativa de Construtores Locais",
      "type": "Cooperativa",
      "location": {
        "name": "Açu, SJB",
        "lat": -21.861,
        "lng": -41.026
      }
    },
    {
      "id": "actor-07",
      "name": "SENAI",
      "type": "Educação",
      "location": {
        "name": "Campos dos Goytacazes",
        "lat": -21.761,
        "lng": -41.332
      }
    }
  ],
  "project": {
    "id": "proj-sedvivo-01",
    "name": "Sedimento Vivo",
    "vision": "Transformar o maior resíduo da Ferroport - o sedimento de dragagem - de um passivo operacional e ambiental em um ativo estratégico de triplo impacto: Ambiental, Social e de Governança.",
    "phases": [
      {
        "id": "phase-01",
        "name": "Fase 1: Estruturação e Viabilidade",
        "objective": "Validar a viabilidade técnica, regulatória e econômica, formando a governança do projeto e as parcerias estratégicas iniciais.",
        "kanbanColumns": ["A Fazer", "Em Andamento", "Concluído"]
      },
      {
        "id": "phase-02",
        "name": "Fase 2: Projeto Piloto e Validação",
        "objective": "Testar a solução em uma escala controlada, produzindo os primeiros lotes de materiais e executando uma obra demonstrativa.",
        "kanbanColumns": ["A Fazer", "Em Andamento", "Concluído"]
      },
      {
        "id": "phase-03",
        "name": "Fase 3: Escalonamento Operacional",
        "objective": "Construir a infraestrutura definitiva, capacitar a mão de obra local e iniciar a produção em larga escala.",
        "kanbanColumns": ["A Fazer", "Em Andamento", "Concluído"]
      },
      {
        "id": "phase-04",
        "name": "Fase 4: Operação Contínua",
        "objective": "Consolidar a operação, monitorar impactos e promover a inovação contínua.",
        "kanbanColumns": ["A Fazer", "Em Andamento", "Concluído"]
      }
    ]
  },
  "tasks": [
    {
      "id": "task-001",
      "phaseId": "phase-01",
      "title": "Caracterização Técnica do Sedimento",
      "description": "Coletar e analisar amostras para garantir conformidade com as normas ABNT e CONAMA.",
      "status": "Concluído",
      "assignedTo": ["actor-01", "actor-02"],
      "startDate": "2025-01-15",
      "endDate": "2025-04-30",
      "deliverableIds": ["del-001"],
      "kpiImpact": []
    },
    {
      "id": "task-002",
      "phaseId": "phase-01",
      "title": "Formalização de Parcerias",
      "description": "Elaborar e assinar Memorandos de Entendimento (MoU) com Prefeituras e Universidades.",
      "status": "Concluído",
      "assignedTo": ["actor-01", "actor-03"],
      "startDate": "2025-03-01",
      "endDate": "2025-06-15",
      "deliverableIds": ["del-002"],
      "kpiImpact": []
    },
    {
      "id": "task-003",
      "phaseId": "phase-01",
      "title": "Análise Regulatória e Licenciamento",
      "description": "Iniciar diálogo com o INEA para avaliar os procedimentos de licenciamento ambiental.",
      "status": "Em Andamento",
      "assignedTo": ["actor-04"],
      "startDate": "2025-05-01",
      "endDate": "2025-09-30",
      "deliverableIds": ["del-003"],
      "kpiImpact": []
    },
    {
      "id": "task-004",
      "phaseId": "phase-02",
      "title": "Produção dos Protótipos",
      "description": "Produzir os primeiros 5.000 blocos e 1.000 m² de pavers em planta piloto.",
      "status": "A Fazer",
      "assignedTo": ["actor-06"],
      "startDate": "2025-10-01",
      "endDate": "2025-12-31",
      "deliverableIds": ["del-004"],
      "kpiImpact": [
        { "key": "sedimentReused_m3", "value": 5000, "label": "Sedimento Reutilizado (m³)" }
      ]
    },
    {
      "id": "task-005",
      "phaseId": "phase-02",
      "title": "Execução de Obra Demonstrativa",
      "description": "Pavimentação de 500m de rua na comunidade de Pipeiras.",
      "status": "A Fazer",
      "assignedTo": ["actor-03", "actor-05"],
      "startDate": "2026-01-15",
      "endDate": "2026-03-15",
      "deliverableIds": ["del-005"],
      "kpiImpact": [
        { "key": "familiesBenefited", "value": 40, "label": "Famílias Beneficiadas" },
        { "key": "areaPaved_m2", "value": 2000, "label": "Área Pavimentada (m²)" },
        { "key": "ghgAvoided_tCO2e", "value": 15, "label": "GEE Evitado (tCO₂e)" }
      ]
    },
    {
        "id": "task-006",
        "phaseId": "phase-03",
        "title": "Capacitação da Mão de Obra Local",
        "description": "Programa de capacitação em parceria com o SENAI para 30 moradores locais.",
        "status": "A Fazer",
        "assignedTo": ["actor-07"],
        "startDate": "2026-04-01",
        "endDate": "2026-06-30",
        "deliverableIds": [],
        "kpiImpact": [
          { "key": "peopleTrained", "value": 30, "label": "Pessoas Capacitadas" },
          { "key": "jobsCreated", "value": 15, "label": "Empregos Gerados" }
        ]
    },
    {
      "id": "task-007",
      "phaseId": "phase-01",
      "title": "Mapeamento de Stakeholders",
      "description": "Identificar e engajar todas as partes interessadas, incluindo comunidades, governo e indústria.",
      "status": "Concluído",
      "assignedTo": ["actor-01", "actor-03", "actor-05"],
      "startDate": "2025-02-01",
      "endDate": "2025-04-01",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-008",
      "phaseId": "phase-01",
      "title": "Estudo de Mercado para Produtos",
      "description": "Analisar a demanda e o potencial de mercado para tijolos, pavers e outros produtos derivados do sedimento.",
      "status": "Em Andamento",
      "assignedTo": ["actor-02", "actor-06"],
      "startDate": "2025-06-01",
      "endDate": "2025-08-30",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-009",
      "phaseId": "phase-02",
      "title": "Desenvolvimento de Traços de Concreto",
      "description": "Testar diferentes proporções de cimento, areia e sedimento para otimizar resistência e custo.",
      "status": "A Fazer",
      "assignedTo": ["actor-02", "actor-07"],
      "startDate": "2025-10-15",
      "endDate": "2026-01-15",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-010",
      "phaseId": "phase-02",
      "title": "Licenciamento da Planta Piloto",
      "description": "Submeter e acompanhar o processo de licenciamento ambiental para a operação piloto junto ao INEA.",
      "status": "A Fazer",
      "assignedTo": ["actor-04"],
      "startDate": "2025-11-01",
      "endDate": "2026-02-28",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-011",
      "phaseId": "phase-03",
      "title": "Construção da Unidade de Beneficiamento",
      "description": "Edificação da planta industrial para processamento, mistura e produção em larga escala.",
      "status": "A Fazer",
      "assignedTo": ["actor-06"],
      "startDate": "2026-07-01",
      "endDate": "2027-03-30",
      "deliverableIds": [],
      "kpiImpact": [
        { "key": "jobsCreated", "value": 25, "label": "Empregos Gerados" }
      ]
    },
    {
      "id": "task-012",
      "phaseId": "phase-03",
      "title": "Logística de Distribuição",
      "description": "Estruturar a logística para transporte de matéria-prima e distribuição dos produtos finais na região.",
      "status": "A Fazer",
      "assignedTo": ["actor-01", "actor-06"],
      "startDate": "2027-01-01",
      "endDate": "2027-04-30",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-013",
      "phaseId": "phase-04",
      "title": "Monitoramento Contínuo de Qualidade",
      "description": "Implementar rotina de testes de laboratório para garantir a conformidade dos produtos com as normas técnicas.",
      "status": "A Fazer",
      "assignedTo": ["actor-02"],
      "startDate": "2027-05-01",
      "endDate": "2027-12-31",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-014",
      "phaseId": "phase-04",
      "title": "Relatório Anual de Impacto",
      "description": "Publicar relatório anual com os resultados e impactos socioambientais do projeto para stakeholders.",
      "status": "A Fazer",
      "assignedTo": ["actor-01"],
      "startDate": "2027-12-01",
      "endDate": "2028-01-30",
      "deliverableIds": [],
      "kpiImpact": []
    },
    {
      "id": "task-015",
      "phaseId": "phase-04",
      "title": "Pesquisa de Novas Aplicações",
      "description": "Manter parceria com a UENF para pesquisar e desenvolver novos produtos a partir do sedimento.",
      "status": "A Fazer",
      "assignedTo": ["actor-02"],
      "startDate": "2027-06-01",
      "endDate": "2028-06-01",
      "deliverableIds": [],
      "kpiImpact": []
    }
  ],
  "deliverables": [
    {
      "id": "del-001",
      "taskId": "task-001",
      "name": "Relatório de Viabilidade Técnica",
      "status": "Entregue",
      "url": "/docs/relatorio-viabilidade.pdf"
    },
    {
      "id": "del-002",
      "taskId": "task-002",
      "name": "MoUs Assinados",
      "status": "Entregue",
      "url": "/docs/mous-assinados.zip"
    },
    {
      "id": "del-003",
      "taskId": "task-003",
      "name": "Parecer Jurídico-Regulatório",
      "status": "Pendente",
      "url": null
    },
    {
      "id": "del-004",
      "taskId": "task-004",
      "name": "Protótipos com Laudos Técnicos",
      "status": "Pendente",
      "url": null
    },
    {
      "id": "del-005",
      "taskId": "task-005",
      "name": "Relatório Fotográfico da Obra",
      "status": "Pendente",
      "url": null
    }
  ],
  "dashboardData": {
    "kpiSummary": [
      { "key": "sedimentReused_m3", "value": 5000, "label": "Sedimento Reutilizado (m³)" },
      { "key": "familiesBenefited", "value": 40, "label": "Famílias Beneficiadas" },
      { "key": "peopleTrained", "value": 30, "label": "Pessoas Capacitadas" },
      { "key": "jobsCreated", "value": 40, "label": "Empregos Gerados" },
      { "key": "ghgAvoided_tCO2e", "value": 15, "label": "GEE Evitado (tCO₂e)" }
    ],
    "timelineEvents": [
      { "id": "task-001", "phase": "Fase 1", "content": "Caracterização do Sedimento", "start": "2025-01-15", "end": "2025-04-30", "group": "Viabilidade" },
      { "id": "task-002", "phase": "Fase 1", "content": "Formalização de Parcerias", "start": "2025-03-01", "end": "2025-06-15", "group": "Viabilidade" },
      { "id": "task-003", "phase": "Fase 1", "content": "Análise Regulatória", "start": "2025-05-01", "end": "2025-09-30", "group": "Viabilidade" },
      { "id": "task-004", "phase": "Fase 2", "content": "Produção dos Protótipos", "start": "2025-10-01", "end": "2025-12-31", "group": "Piloto" },
      { "id": "task-005", "phase": "Fase 2", "content": "Obra Demonstrativa", "start": "2026-01-15", "end": "2026-03-15", "group": "Piloto" },
      { "id": "task-006", "phase": "Fase 3", "content": "Capacitação Profissional", "start": "2026-04-01", "end": "2026-06-30", "group": "Escala" },
      { "id": "task-007", "phase": "Fase 1", "content": "Mapeamento de Stakeholders", "start": "2025-02-01", "end": "2025-04-01", "group": "Viabilidade" },
      { "id": "task-008", "phase": "Fase 1", "content": "Estudo de Mercado", "start": "2025-06-01", "end": "2025-08-30", "group": "Viabilidade" },
      { "id": "task-009", "phase": "Fase 2", "content": "Desenvolvimento de Traços", "start": "2025-10-15", "end": "2026-01-15", "group": "Piloto" },
      { "id": "task-010", "phase": "Fase 2", "content": "Licenciamento Piloto", "start": "2025-11-01", "end": "2026-02-28", "group": "Piloto" },
      { "id": "task-011", "phase": "Fase 3", "content": "Construção da Unidade", "start": "2026-07-01", "end": "2027-03-30", "group": "Escala" },
      { "id": "task-012", "phase": "Fase 3", "content": "Logística de Distribuição", "start": "2027-01-01", "end": "2027-04-30", "group": "Escala" },
      { "id": "task-013", "phase": "Fase 4", "content": "Monitoramento de Qualidade", "start": "2027-05-01", "end": "2027-12-31", "group": "Operação" },
      { "id": "task-014", "phase": "Fase 4", "content": "Relatório Anual de Impacto", "start": "2027-12-01", "end": "2028-01-30", "group": "Operação" },
      { "id": "task-015", "phase": "Fase 4", "content": "P&D Novas Aplicações", "start": "2027-06-01", "end": "2028-06-01", "group": "Operação" }
    ],
    "mapPoints": [
       {
        "id": "actor-01",
        "name": "Ferroport (Sede do Projeto)",
        "type": "Grupo Interno",
        "position": [-21.8219, -41.0186],
        "popup": "<strong>Comitê Gestor Ferroport</strong><br>Ponto central de governança do projeto Sedimento Vivo."
      },
      {
        "id": "actor-03",
        "name": "Prefeitura de São João da Barra",
        "type": "Poder Público",
        "position": [-21.6401, -41.051],
        "popup": "<strong>Parceiro Chave</strong><br>Demanda de materiais para obras de infraestrutura e habitação social."
      },
      {
        "id": "actor-05",
        "name": "Comunidade de Pipeiras",
        "type": "Comunidade",
        "position": [-21.668, -41.060],
        "popup": "<strong>Projeto Piloto</strong><br>Local da primeira obra demonstrativa de pavimentação comunitária."
      }
    ]
  }
}
    </script>

    <script type="module">
        // --- DATA INITIALIZATION ---
        const db = JSON.parse(document.getElementById('db-json').textContent);

        // --- APP STATE ---
        const state = {
            currentPage: '',
            tasks: db.tasks,
        };

        // --- DOM ELEMENTS ---
        const mainContent = document.getElementById('main-content');
        const navLinks = document.querySelectorAll('.nav-link');
        const mobileNavLinks = document.querySelectorAll('#mobile-menu .nav-link');
        const taskModal = document.getElementById('task-modal');
        const taskModalContent = document.getElementById('task-modal-inner-content');
        const actorModal = document.getElementById('actor-modal');
        const actorModalContent = document.getElementById('actor-modal-inner-content');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const profileButton = document.getElementById('profile-button');
        const profileDropdown = document.getElementById('profile-dropdown');
        const menuIconOpen = document.getElementById('menu-icon-open');
        const menuIconClose = document.getElementById('menu-icon-close');

        // --- ROUTING ---
        function navigateTo(hash) {
            const page = hash.substring(1) || 'dashboard';
            if (page === state.currentPage) return;
            
            state.currentPage = page;
            updateNavLinks(page);
            renderPage(page);
        }

        function updateNavLinks(activePage) {
            document.querySelectorAll('.nav-link').forEach(link => {
                 if (link.href.endsWith(`#${activePage}`)) {
                    link.classList.add('active');
                    link.classList.remove('text-gray-700');
                } else {
                    link.classList.remove('active');
                    link.classList.add('text-gray-700');
                }
            });
        }

        function renderPage(page) {
            mainContent.innerHTML = ''; // Clear previous content
            window.scrollTo(0, 0);

            switch (page) {
                case 'dashboard':
                    mainContent.innerHTML = renderDashboard();
                    initDashboardCharts();
                    break;
                case 'kanban':
                    mainContent.innerHTML = renderKanban();
                    initKanban();
                    break;
                case 'actors':
                    mainContent.innerHTML = renderActorsPage();
                    initActorsPage();
                    break;
                case 'deliverables':
                    mainContent.innerHTML = renderDeliverablesPage();
                    break;
                default:
                    mainContent.innerHTML = `<div class="text-center p-10"><h2 class="text-2xl font-bold">Página não encontrada</h2></div>`;
            }
        }
        
        // --- PAGE RENDERERS ---

        function renderDashboard() {
            const kpis = db.dashboardData.kpiSummary;
            return `
                <div class="space-y-8">
                    <div>
                        <h1 class="text-3xl font-bold text-text-primary">Dashboard de Impacto</h1>
                        <p class="mt-2 text-text-secondary">Visão geral do progresso e impacto do projeto.</p>
                    </div>
                    
                    <!-- KPI Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6">
                        ${kpis.map((kpi, index) => {
                            const colors = [
                                { border: 'border-green-500', text: 'text-green-600', iconBg: 'bg-green-100' },
                                { border: 'border-sky-500', text: 'text-sky-600', iconBg: 'bg-sky-100' },
                                { border: 'border-blue-500', text: 'text-blue-600', iconBg: 'bg-blue-100' },
                                { border: 'border-amber-500', text: 'text-amber-600', iconBg: 'bg-amber-100' },
                                { border: 'border-violet-500', text: 'text-violet-600', iconBg: 'bg-violet-100' },
                            ];
                            const color = colors[index % colors.length];

                            const icons = [
                                // Sedimento Reutilizado
                                `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 ${color.text}"><path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" /></svg>`,
                                // Famílias Beneficiadas
                                `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 ${color.text}"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 21v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21m0 0h4.5V3.545M12.75 21h7.5V10.75M2.25 21h1.5m18 0h-18M2.25 9l4.5-1.636M18.75 3l-1.5.545m0 6.205l3 1m1.5.5-1.5-.5M5.25 7.455 3 9m0 0l-1.5-1.5" /></svg>`,
                                // Pessoas Capacitadas
                                `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 ${color.text}"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>`,
                                // Empregos Gerados
                                `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 ${color.text}"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 14.15v4.075c0 1.313-1.062 2.375-2.375 2.375H6.125c-1.313 0-2.375-1.062-2.375-2.375V14.15M12 4.5v6.75m0 0l-3.75-3.75M12 11.25l3.75-3.75M12 4.5c1.933 0 3.5 1.567 3.5 3.5s-1.567 3.5-3.5 3.5-3.5-1.567-3.5-3.5 1.567-3.5 3.5-3.5z" /></svg>`,
                                // GEE Evitado
                                `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-8 h-8 ${color.text}"><path stroke-linecap="round" stroke-linejoin="round" d="M12.75 3.375A9.375 9.375 0 003.375 12.75 9.375 9.375 0 0012.75 22.125 9.375 9.375 0 0022.125 12.75 9.375 9.375 0 0012.75 3.375z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9.75l-4.5 4.5-2.25-2.25" /></svg>`
                            ];

                            return `
                                <div class="bg-surface p-4 rounded-lg shadow-md border-l-4 ${color.border} flex items-center space-x-4">
                                    <div class="flex-shrink-0 w-14 h-14 rounded-lg ${color.iconBg} flex items-center justify-center">
                                        ${icons[index % icons.length]}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="text-sm font-medium text-text-secondary truncate">${kpi.label}</p>
                                        <p class="text-2xl xl:text-3xl font-bold ${color.text}">${kpi.value.toLocaleString('pt-BR')}</p>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>

                    <!-- Charts Row -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-surface p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-1">Engajamento por Ator</h3>
                            <p class="text-sm text-text-secondary mb-4">Número de tarefas atribuídas a cada organização.</p>
                            <canvas id="actors-chart" style="max-height: 350px;"></canvas>
                        </div>
                        <div class="bg-surface p-6 rounded-lg shadow-md">
                             <h3 class="text-lg font-semibold mb-1">Progresso Geral das Tarefas</h3>
                             <p class="text-sm text-text-secondary mb-4">Um resumo do status de todas as atividades planejadas.</p>
                            <canvas id="tasks-chart" style="max-height: 350px;"></canvas>
                        </div>
                    </div>

                    <div class="space-y-8 mt-8">
                        <div class="bg-surface p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-1">Cronograma Interativo do Projeto</h3>
                            <p class="text-sm text-text-secondary mb-4">Navegue pelas fases e veja as principais entregas ao longo do tempo.</p>
                            <div id="timeline-container" style="height: 400px;"></div>
                        </div>

                        <div class="bg-surface p-6 rounded-lg shadow-md">
                            <h3 class="text-lg font-semibold mb-4">Mapa de Atores e Impacto</h3>
                            <div id="map" class="rounded-lg" style="height: 500px;"></div>
                        </div>

                        <!-- Produtos Gerados -->
                        <section id="produtos">
                            <div class="text-center mb-12">
                                <h3 class="text-sm font-bold uppercase" style="color: var(--color-primary);">Produtos e Aplicações</h3>
                                <h2 class="text-3xl md:text-4xl font-bold text-text-primary mt-2">Um universo de possibilidades sustentáveis.</h2>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                <!-- Produto 1 -->
                                <div class="rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 bg-surface">
                                    <img src="https://www.amigoconstrutor.com.br/dw/image/v2/BHFQ_PRD/on/demandware.static/-/Library-Sites-AmigoConstrutorSharedLibrary/default/dw2e6469bd/IMAGENS-BLOG/homem-construindo-tijolo-ecologico.jpg" alt="Tijolo Ecológico feito com sedimento" class="w-full h-56 object-cover">
                                    <div class="p-6">
                                        <h4 class="text-xl font-bold mb-2 text-text-primary">Tijolo Ecológico</h4>
                                        <p class="text-text-secondary">Resistente e com ótimo isolamento térmico, utiliza o sedimento como agregado, reduzindo o consumo de cimento e o custo final.</p>
                                    </div>
                                </div>
                                <!-- Produto 2 -->
                                <div class="rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 bg-surface">
                                    <img src="https://blocosdeconcretoarttraco.com.br/uploads/paver-para-calcada.jpg" alt="Bloco intertravado para pavimentação" class="w-full h-56 object-cover">
                                    <div class="p-6">
                                        <h4 class="text-xl font-bold mb-2 text-text-primary">Bloco de Pavimentação</h4>
                                        <p class="text-text-secondary">Ideal para calçadas, praças e ruas de baixo tráfego. Uma solução durável e permeável para a infraestrutura urbana da região.</p>
                                    </div>
                                </div>
                                <!-- Produto 3 -->
                                <div class="rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 bg-surface">
                                    <img src="https://jangadashow.com.br/wp-content/uploads/2023/11/3QbAI0W-1024x576.jpg" alt="Areia para alimentação de praias" class="w-full h-56 object-cover">
                                    <div class="p-6">
                                        <h4 class="text-xl font-bold mb-2 text-text-primary">Resiliência Costeira</h4>
                                        <p class="text-text-secondary">A fração arenosa do sedimento, de alta compatibilidade, é ideal para projetos de "engorda" de praias, combatendo a erosão costeira.</p>
                                    </div>
                                </div>
                                <!-- Produto 4 -->
                                <div class="rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 bg-surface">
                                    <img src="https://lh7-rt.googleusercontent.com/docsz/AD_4nXc8MkHwWgChHN8bMr91Qj9_TT65jymZNCjegMEfeh3dgY_ClEPAs7TxsqlSHkkRa9ESGBJuzaBLpe2m_-ZKUKFLlkhcb06uwUd1r9SXZuHMnPXJP33dF6Au09fAoefWYGLNbhWYpy2yG0nYjOrOCMhLG4I-w3DsikzJI_ekEYqLgT-_9RgLtA?key=zlBde046Y4kuP96xAFUaRw" alt="Sub-base para estradas" class="w-full h-56 object-cover">
                                    <div class="p-6">
                                        <h4 class="text-xl font-bold mb-2 text-text-primary">Sub-base para Estradas</h4>
                                        <p class="text-text-secondary">Após tratamento, o sedimento pode compor a camada de sub-base de vias e pátios, reduzindo a necessidade de extração de areia e brita.</p>
                                    </div>
                                </div>
                                <!-- Produto 5 -->
                                <div class="rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 bg-surface">
                                    <img src="https://p.turbosquid.com/ts-thumb/In/EdMoZt/HH6TGkum/preview_00/jpg/1524726891/600x600/fit_q87/f50ff3300ce9beea42ec57e38187ae591250e324/preview_00.jpg" alt="Artefatos de concreto como bancos e vasos" class="w-full h-56 object-cover">
                                    <div class="p-6">
                                        <h4 class="text-xl font-bold mb-2 text-text-primary">Mobiliário Urbano</h4>
                                        <p class="text-text-secondary">Produção de bancos de praça, vasos, meios-fios e outros artefatos de concreto para uso em espaços públicos, aliando durabilidade e sustentabilidade.</p>
                                    </div>
                                </div>
                                <!-- Produto 6 -->
                                <div class="rounded-lg overflow-hidden shadow-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 bg-surface">
                                    <img src="https://espacoecologico.com.br/wp-content/uploads/2022/12/argamassa.jpg" alt="Argamassa sustentável" class="w-full h-56 object-cover">
                                    <div class="p-6">
                                        <h4 class="text-xl font-bold mb-2 text-text-primary">Argamassa Sustentável</h4>
                                        <p class="text-text-secondary">A fração fina do sedimento pode ser incorporada a argamassas para assentamento e revestimento, diminuindo o uso de cimento.</p>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            `;
        }
        
        function renderKanban() {
            const phases = db.project.phases;
            return `
                <div>
                    <h1 class="text-3xl font-bold text-text-primary">Kanban do Projeto: ${db.project.name}</h1>
                    <p class="mt-2 text-text-secondary">${db.project.vision}</p>
                </div>
                
                <div class="space-y-12 mt-8">
                    ${phases.map(phase => `
                        <section id="phase-${phase.id}">
                            <h2 class="text-2xl font-semibold mb-4" style="color: var(--color-primary);">${phase.name}</h2>
                            <p class="text-text-secondary mb-6">${phase.objective}</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                ${phase.kanbanColumns.map(column => `
                                    <div class="bg-surface rounded-lg shadow-inner p-4">
                                        <h3 class="font-bold text-center text-text-secondary pb-3 border-b-2 mb-4">${column}</h3>
                                        <div id="col-${phase.id}-${column.replace(/\s+/g, '-')}" class="kanban-column drop-zone space-y-4">
                                            ${renderKanbanCards(phase.id, column)}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </section>
                    `).join('')}
                </div>
            `;
        }

        function renderKanbanCards(phaseId, status) {
            return state.tasks
                .filter(task => task.phaseId === phaseId && task.status === status)
                .map(task => {
                    const assignedActors = task.assignedTo.map(actorId => db.actors.find(a => a.id === actorId)).filter(Boolean);
                    const deliverables = task.deliverableIds.map(delId => db.deliverables.find(d => d.id === delId)).filter(Boolean);
                    
                    return `
                        <div id="${task.id}" class="kanban-card bg-white p-4 rounded-lg shadow" draggable="true">
                            <h4 class="font-semibold text-text-primary">${task.title}</h4>
                            <p class="text-sm text-text-secondary my-2 line-clamp-2">${task.description}</p>
                            
                            <!-- Deliverables -->
                            ${deliverables.length > 0 ? `
                                <div class="mt-3">
                                    <h5 class="text-xs font-bold text-gray-500">ENTREGÁVEIS</h5>
                                    <div class="flex flex-col space-y-1 mt-1">
                                    ${deliverables.slice(0, 1).map(del => `
                                        <div class="text-xs text-gray-600 flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                                            ${del.name}
                                        </div>
                                    `).join('')}
                                    ${deliverables.length > 1 ? `<div class="text-xs text-gray-500">+${deliverables.length - 1} outro(s)</div>` : ''}
                                    </div>
                                </div>
                            ` : ''}

                            <div class="flex justify-between items-center mt-4 pt-3 border-t">
                                <div class="flex items-center">
                                    ${assignedActors.map(actor => `
                                        <img src="https://i.pravatar.cc/40?u=${actor.id}" title="${actor.name}" class="actor-avatar">
                                    `).join('')}
                                </div>
                                <span class="text-xs font-semibold bg-primary/80 text-white px-2 py-1 rounded-full">${new Date(task.endDate).toLocaleDateString('pt-BR')}</span>
                            </div>
                        </div>
                    `;
                }).join('');
        }
        
        function renderActorsPage() {
            return `
                 <div>
                    <h1 class="text-3xl font-bold text-text-primary">Atores Envolvidos</h1>
                    <p class="mt-2 text-text-secondary">Pessoas e instituições que fazem o projeto acontecer.</p>
                </div>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${db.actors.map(actor => `
                        <div class="actor-card bg-surface p-5 rounded-lg shadow-md flex items-start space-x-4 cursor-pointer hover:shadow-xl hover:scale-[1.02] transition-all duration-300" data-actor-id="${actor.id}">
                            <img src="https://i.pravatar.cc/150?u=${actor.id}" alt="${actor.name}" class="h-16 w-16 rounded-full border-2 border-primary">
                            <div>
                                <h3 class="text-lg font-bold" style="color: var(--color-primary);">${actor.name}</h3>
                                <p class="text-sm font-medium bg-primary/20 text-primary inline-block px-2 py-0.5 rounded-full my-1" style="background-color: rgba(111, 179, 110, 0.2); color: var(--color-primary);">${actor.type}</p>
                                <p class="text-sm text-text-secondary flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" />
                                    </svg>
                                    ${actor.location.name}
                                </p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderDeliverablesPage() {
             return `
                 <div>
                    <h1 class="text-3xl font-bold text-text-primary">Entregáveis do Projeto</h1>
                    <p class="mt-2 text-text-secondary">Documentos, relatórios e produtos gerados pelas tarefas.</p>
                </div>
                <div class="mt-8 bg-surface rounded-lg shadow-md overflow-hidden">
                    <table class="min-w-full">
                        <thead style="background-color: rgba(111, 179, 110, 0.1);">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--color-primary);">Entregável</th>
                                <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--color-primary);">Tarefa Associada</th>
                                <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--color-primary);">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-bold uppercase tracking-wider" style="color: var(--color-primary);">Ação</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            ${db.deliverables.map(del => {
                                const task = db.tasks.find(t => t.id === del.taskId);
                                const statusClass = del.status === 'Entregue' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                                return `
                                    <tr>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <p class="font-semibold text-text-primary">${del.name}</p>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <p class="text-sm text-text-secondary">${task ? task.title : 'N/A'}</p>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
                                                ${del.status}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            ${del.url ? `
                                                <a href="${del.url}" target="_blank" class="hover:underline font-bold" style="color: var(--color-primary);">Ver Documento</a>
                                            ` : `
                                                <span class="text-gray-400">Indisponível</span>
                                            `}
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
             `;
        }

        // --- MODAL LOGIC ---
        function openTaskModal(taskId) {
            const task = db.tasks.find(t => t.id === taskId);
            if (!task) return;

            const assignedActors = task.assignedTo.map(actorId => db.actors.find(a => a.id === actorId)).filter(Boolean);
            const deliverables = task.deliverableIds.map(delId => db.deliverables.find(d => d.id === delId)).filter(Boolean);
            const phase = db.project.phases.find(p => p.id === task.phaseId);

            const statusColors = {
                'Concluído': 'bg-green-100 text-green-800',
                'Em Andamento': 'bg-yellow-100 text-yellow-800',
                'A Fazer': 'bg-gray-200 text-gray-800',
            };

            taskModalContent.innerHTML = `
                <div class="relative">
                    <button id="close-modal-btn" class="absolute -top-2 -right-4 text-gray-400 hover:text-gray-800 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <div>
                        <span class="text-sm font-semibold" style="color: var(--color-primary);">${phase ? phase.name : ''}</span>
                        <h2 class="text-2xl sm:text-3xl font-bold text-text-primary mt-1">${task.title}</h2>
                    </div>

                    <div class="mt-4 flex flex-wrap gap-4 items-center text-sm">
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColors[task.status] || 'bg-gray-100'}">
                            ${task.status}
                        </span>
                        <div class="flex items-center text-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
                            <span>Prazo: ${new Date(task.endDate).toLocaleDateString('pt-BR')}</span>
                        </div>
                    </div>

                    <p class="text-text-secondary my-6">${task.description}</p>

                    <div>
                        <h4 class="font-semibold text-text-primary mb-3">Responsáveis</h4>
                        <div class="flex flex-wrap gap-4">
                            ${assignedActors.map(actor => `
                                <div class="flex items-center space-x-3">
                                    <img src="https://i.pravatar.cc/40?u=${actor.id}" title="${actor.name}" class="h-10 w-10 rounded-full">
                                    <div>
                                    <p class="font-medium text-sm">${actor.name}</p>
                                    <p class="text-xs text-gray-500">${actor.type}</p>
                                    </div>
                                </div>
                            `).join('') || '<p class="text-sm text-gray-500">Nenhum responsável atribuído.</p>'}
                        </div>
                    </div>
                    
                    ${deliverables.length > 0 ? `
                        <div class="mt-6">
                            <h4 class="font-semibold text-text-primary mb-3">Entregáveis</h4>
                            <ul class="space-y-2">
                                ${deliverables.map(del => `
                                    <li class="text-sm">
                                        <a href="${del.url || '#'}" class="text-blue-600 hover:underline flex items-center ${del.url ? '' : 'opacity-50 pointer-events-none'}">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                                            <span>${del.name} <span class="text-gray-500 text-xs">(${del.status})</span></span>
                                        </a>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    ` : ''}

                     ${task.kpiImpact && task.kpiImpact.length > 0 ? `
                        <div class="mt-6">
                            <h4 class="font-semibold text-text-primary mb-3">Impacto nos KPIs</h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            ${task.kpiImpact.map(kpi => `
                                <div class="bg-primary/10 p-3 rounded-lg">
                                    <p class="text-xs font-medium" style="color: var(--color-primary);">${kpi.label}</p>
                                    <p class="text-xl font-bold mt-1" style="color: var(--color-primary);">+${kpi.value.toLocaleString('pt-BR')}</p>
                                </div>
                            `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            taskModal.classList.remove('hidden');
            taskModal.classList.add('flex');
            setTimeout(() => taskModal.classList.add('visible'), 10);
            
            document.getElementById('close-modal-btn').addEventListener('click', closeTaskModal);
        }

        function closeTaskModal() {
            taskModal.classList.remove('visible');
            setTimeout(() => {
                taskModal.classList.add('hidden');
                taskModal.classList.remove('flex');
                taskModalContent.innerHTML = '';
            }, 300);
        }

        function openActorModal(actorId) {
            const actor = db.actors.find(a => a.id === actorId);
            if (!actor) return;

            const actorTasks = db.tasks.filter(task => task.assignedTo.includes(actorId));
            const actorDeliverableIds = actorTasks.flatMap(task => task.deliverableIds);
            const actorDeliverables = db.deliverables.filter(del => actorDeliverableIds.includes(del.id));

            const statusColors = {
                'Concluído': 'bg-green-100 text-green-800',
                'Em Andamento': 'bg-yellow-100 text-yellow-800',
                'A Fazer': 'bg-gray-200 text-gray-800',
                'Entregue': 'bg-green-100 text-green-800',
                'Pendente': 'bg-yellow-100 text-yellow-800'
            };
            
            actorModalContent.innerHTML = `
                <div class="relative">
                    <button id="close-actor-modal-btn" class="absolute -top-2 -right-4 text-gray-400 hover:text-gray-800 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <div class="flex items-center space-x-4">
                        <img src="https://i.pravatar.cc/150?u=${actor.id}" alt="${actor.name}" class="h-20 w-20 rounded-full border-4 border-primary">
                        <div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-text-primary">${actor.name}</h2>
                            <p class="text-md font-medium" style="color: var(--color-primary);">${actor.type}</p>
                        </div>
                    </div>

                    <div class="mt-8 space-y-6">
                        <div>
                            <h4 class="font-semibold text-text-primary text-lg mb-3 border-b pb-2">Tarefas Associadas</h4>
                            ${actorTasks.length > 0 ? `
                                <ul class="space-y-3">
                                    ${actorTasks.map(task => `
                                        <li class="bg-white/60 p-3 rounded-lg">
                                            <div class="flex justify-between items-start">
                                                <p class="font-semibold text-text-primary">${task.title}</p>
                                                <span class="text-xs font-semibold whitespace-nowrap px-2 py-1 rounded-full ${statusColors[task.status] || 'bg-gray-100'}">${task.status}</span>
                                            </div>
                                            <p class="text-sm text-text-secondary mt-1">${task.description}</p>
                                        </li>
                                    `).join('')}
                                </ul>
                            ` : '<p class="text-sm text-gray-500">Nenhuma tarefa associada a este ator.</p>'}
                        </div>

                        <div>
                            <h4 class="font-semibold text-text-primary text-lg mb-3 border-b pb-2">Entregáveis Gerados</h4>
                             ${actorDeliverables.length > 0 ? `
                                <ul class="space-y-2">
                                    ${actorDeliverables.map(del => `
                                        <li class="text-sm">
                                            <a href="${del.url || '#'}" class="text-blue-600 hover:underline flex items-center ${del.url ? '' : 'opacity-50 pointer-events-none'}">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg>
                                                <span>${del.name} <span class="px-2 py-0.5 ml-2 text-xs font-semibold rounded-full ${statusColors[del.status] || 'bg-gray-100'}">${del.status}</span></span>
                                            </a>
                                        </li>
                                    `).join('')}
                                </ul>
                            ` : '<p class="text-sm text-gray-500">Nenhum entregável gerado por este ator.</p>'}
                        </div>
                    </div>
                </div>
            `;

            actorModal.classList.remove('hidden');
            actorModal.classList.add('flex');
            setTimeout(() => actorModal.classList.add('visible'), 10);
            
            document.getElementById('close-actor-modal-btn').addEventListener('click', closeActorModal);
        }

        function closeActorModal() {
            actorModal.classList.remove('visible');
            setTimeout(() => {
                actorModal.classList.add('hidden');
                actorModal.classList.remove('flex');
                actorModalContent.innerHTML = '';
            }, 300);
        }

        // --- INITIALIZATION LOGIC ---

        function initDashboardCharts() {
            // Timeline
            if (document.getElementById('timeline-container')) {
                 const container = document.getElementById('timeline-container');
                 const items = new vis.DataSet(db.dashboardData.timelineEvents);
                 const groups = new vis.DataSet([
                    {id: 'Viabilidade', content: 'Fase 1: Viabilidade'},
                    {id: 'Piloto', content: 'Fase 2: Piloto'},
                    {id: 'Escala', content: 'Fase 3: Escala'},
                    {id: 'Operação', content: 'Fase 4: Operação'},
                 ]);

                const options = {
                    stack: false,
                    groupOrder: 'content',
                    margin: { item: { horizontal: 5, vertical: 10 } },
                    zoomable: true,
                    zoomMin: 1000 * 60 * 60 * 24 * 30, // 1 mês
                    zoomMax: 1000 * 60 * 60 * 24 * 365 * 3, // 3 anos
                };
                const timeline = new vis.Timeline(container, items, groups, options);
                timeline.addCustomTime(new Date(), 'today-marker');
                timeline.setCustomTimeTitle('Hoje', 'today-marker');
                timeline.fit();
            }

            // Tasks Chart (Doughnut)
            if (document.getElementById('tasks-chart')) {
                const ctx = document.getElementById('tasks-chart').getContext('2d');
                const statusCounts = state.tasks.reduce((acc, task) => {
                    acc[task.status] = (acc[task.status] || 0) + 1;
                    return acc;
                }, {});

                const totalTasks = Object.values(statusCounts).reduce((sum, count) => sum + count, 0);

                const centerTextPlugin = {
                    id: 'centerText',
                    afterDraw: (chart) => {
                        if (chart.data.datasets[0].data.length === 0) return;
                        const ctx = chart.ctx;
                        const {top, right, bottom, left, width, height} = chart.chartArea;
                        ctx.save();
                        
                        ctx.font = 'bold 2.5rem Inter, sans-serif';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = 'var(--color-text-primary)';
                        const text = totalTasks.toString();
                        const textX = width / 2 + left;
                        const textY = height / 2 + top - 10;
                        ctx.fillText(text, textX, textY);
                        
                        ctx.font = '0.875rem Inter, sans-serif';
                        ctx.fillStyle = 'var(--color-text-secondary)';
                        const subText = 'Total de Tarefas';
                        ctx.fillText(subText, textX, textY + 30);
                        ctx.restore();
                    }
                };

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(statusCounts),
                        datasets: [{
                            label: 'Status das Tarefas',
                            data: Object.values(statusCounts),
                            backgroundColor: [
                                '#FBBF24', // Em Andamento (yellow-400)
                                '#34D399', // Concluído (green-400)
                                '#9CA3AF', // A Fazer (gray-400)
                            ],
                            borderColor: 'var(--color-surface)',
                            borderWidth: 4,
                            cutout: '70%'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    boxWidth: 15,
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + ' tarefa(s)';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    },
                    plugins: [centerTextPlugin]
                });
            }

            // Actors Chart (Horizontal Bar)
            if (document.getElementById('actors-chart')) {
                const ctx = document.getElementById('actors-chart').getContext('2d');
                
                const actorTaskCounts = db.actors.map(actor => {
                    const count = db.tasks.filter(task => task.assignedTo.includes(actor.id)).length;
                    return { name: actor.name, count: count };
                }).filter(actor => actor.count > 0)
                .sort((a, b) => a.count - b.count);

                const actorLabels = actorTaskCounts.map(a => a.name);
                const actorData = actorTaskCounts.map(a => a.count);

                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: actorLabels,
                        datasets: [{
                            label: 'Nº de Tarefas',
                            data: actorData,
                            backgroundColor: 'rgba(111, 179, 110, 0.6)',
                            borderColor: 'rgba(111, 179, 110, 1)',
                            borderWidth: 1,
                            borderRadius: 4
                        }]
                    },
                    options: {
                        indexAxis: 'y',
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }

            // Map
            if(document.getElementById('map')) {
                const map = L.map('map').setView([-21.75, -41.15], 10);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '© OpenStreetMap'
                }).addTo(map);

                const iconMap = {
                    'Grupo Interno': L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]}),
                    'Poder Público': L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]}),
                    'Comunidade': L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-orange.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]}),
                    'Academia': L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]}),
                    'default': L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-grey.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41]})
                };
                
                db.actors.forEach(actor => {
                    const icon = iconMap[actor.type] || iconMap['default'];
                    if(actor.location.lat && actor.location.lng) {
                        L.marker([actor.location.lat, actor.location.lng], {icon: icon}).addTo(map)
                            .bindPopup(`<strong>${actor.name}</strong><br>${actor.type}`);
                    }
                });
            }
        }

        function initKanban() {
            const cards = document.querySelectorAll('.kanban-card');
            const dropZones = document.querySelectorAll('.drop-zone');

            cards.forEach(card => {
                card.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.id);
                    e.dataTransfer.effectAllowed = 'move';
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                });

                card.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
                
                card.addEventListener('click', (e) => {
                    openTaskModal(e.currentTarget.id);
                });
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    zone.classList.add('drag-over');
                });

                zone.addEventListener('dragleave', () => {
                    zone.classList.remove('drag-over');
                });

                zone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    zone.classList.remove('drag-over');
                    
                    const taskId = e.dataTransfer.getData('text/plain');
                    const draggedElement = document.getElementById(taskId);

                    if (draggedElement && zone.id.startsWith('col-')) {
                        zone.appendChild(draggedElement);
                        
                        const idParts = zone.id.split('-');
                        const newStatus = idParts.slice(3).join(' ');

                        // Update state
                        const taskIndex = state.tasks.findIndex(t => t.id === taskId);
                        if (taskIndex !== -1) {
                            state.tasks[taskIndex].status = newStatus;
                            console.log(`Tarefa ${taskId} movida para ${newStatus}`);
                        }
                    }
                });
            });
        }

        function initActorsPage() {
            const actorCards = document.querySelectorAll('.actor-card');
            actorCards.forEach(card => {
                card.addEventListener('click', (e) => {
                    const actorId = e.currentTarget.dataset.actorId;
                    if (actorId) {
                        openActorModal(actorId);
                    }
                });
            });
        }
        
        function initApp() {
            // Load user profile
            const currentUser = db.config.currentUser;
            document.getElementById('current-user-avatar').src = currentUser.avatarUrl;
            
            // Set up router
            window.addEventListener('hashchange', () => navigateTo(window.location.hash));
            navigateTo(window.location.hash || '#dashboard');

            // --- HEADER INTERACTIONS ---
            
            // Mobile menu toggle
            mobileMenuButton.addEventListener('click', () => {
                const isMenuOpen = !mobileMenu.classList.contains('hidden');
                mobileMenu.classList.toggle('hidden');
                menuIconOpen.classList.toggle('hidden', !isMenuOpen);
                menuIconClose.classList.toggle('hidden', isMenuOpen);
            });

            // Close mobile menu when a link is clicked
            document.querySelectorAll('#mobile-menu .nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                    menuIconOpen.classList.remove('hidden');
                    menuIconClose.classList.add('hidden');
                });
            });

            // Profile dropdown toggle
            profileButton.addEventListener('click', (e) => {
                e.stopPropagation();
                const isHidden = profileDropdown.classList.contains('hidden');
                if(isHidden) {
                    profileDropdown.classList.remove('hidden');
                    setTimeout(() => {
                        profileDropdown.classList.remove('opacity-0', 'scale-95');
                    }, 10);
                } else {
                    profileDropdown.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => {
                        profileDropdown.classList.add('hidden');
                    }, 200);
                }
            });

            // Close dropdown when clicking outside
            window.addEventListener('click', (e) => {
                if (!profileDropdown.classList.contains('hidden') && !profileButton.contains(e.target)) {
                    profileDropdown.classList.add('opacity-0', 'scale-95');
                     setTimeout(() => {
                        profileDropdown.classList.add('hidden');
                    }, 200);
                }
            });

            // Modal Global Listeners
            taskModal.addEventListener('click', (e) => {
                if (e.target.id === 'task-modal') {
                    closeTaskModal();
                }
            });

            actorModal.addEventListener('click', (e) => {
                if (e.target.id === 'actor-modal') {
                    closeActorModal();
                }
            });

            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (taskModal.classList.contains('visible')) {
                        closeTaskModal();
                    }
                    if (actorModal.classList.contains('visible')) {
                        closeActorModal();
                    }
                }
            });
        }

        // --- APP START ---
        initApp();

    </script>
</body>
</html>